<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PiePlot3D.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JFreeChart</a> &gt; <a href="index.source.html" class="el_package">org.jfree.chart.plot</a> &gt; <span class="el_source">PiePlot3D.java</span></div><h1>PiePlot3D.java</h1><pre class="source lang-java linenums">/* ===========================================================
 * JFreeChart : a free chart library for the Java(tm) platform
 * ===========================================================
 *
 * (C) Copyright 2000-present, by David Gilbert and Contributors.
 *
 * Project Info:  http://www.jfree.org/jfreechart/index.html
 *
 * This library is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 2.1 of the License, or
 * (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
 * License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 * [Oracle and Java are registered trademarks of Oracle and/or its affiliates.
 * Other names may be trademarks of their respective owners.]
 *
 * --------------
 * PiePlot3D.java
 * --------------
 * (C) Copyright 2000-present, by David Gilbert and Contributors.
 *
 * Original Author:  Tomer Peretz;
 * Contributor(s):   Richard Atkinson;
 *                   David Gilbert;
 *                   Xun Kang;
 *                   Christian W. Zuckschwerdt;
 *                   Arnaud Lelievre;
 *                   Dave Crane;
 *                   Martin Hoeller;
 *                   DaveLaw (dave ATT davelaw DOTT de);
 */

package org.jfree.chart.plot;

import java.awt.AlphaComposite;
import java.awt.Color;
import java.awt.Composite;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics2D;
import java.awt.Paint;
import java.awt.Polygon;
import java.awt.Shape;
import java.awt.Stroke;
import java.awt.geom.Arc2D;
import java.awt.geom.Area;
import java.awt.geom.Ellipse2D;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;
import java.awt.image.BufferedImage;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.jfree.chart.entity.EntityCollection;
import org.jfree.chart.entity.PieSectionEntity;
import org.jfree.chart.event.PlotChangeEvent;
import org.jfree.chart.labels.PieToolTipGenerator;
import org.jfree.chart.ui.RectangleInsets;
import org.jfree.chart.util.PaintAlpha;
import org.jfree.data.general.DatasetUtils;
import org.jfree.data.general.PieDataset;

/**
 * A plot that displays data in the form of a 3D pie chart, using data from
 * any class that implements the {@link PieDataset} interface.
 * &lt;P&gt;
 * Although this class extends {@link PiePlot}, it does not currently support
 * exploded sections.
 * 
 * @deprecated For 3D pie charts, use Orson Charts (https://github.com/jfree/orson-charts).
 */
public class PiePlot3D extends PiePlot implements Serializable {

    /** For serialization. */
    private static final long serialVersionUID = 3408984188945161432L;

    /** The factor of the depth of the pie from the plot height */
<span class="fc" id="L90">    private double depthFactor = 0.12;</span>

    /**
     * A flag that controls whether or not the sides of the pie chart
     * are rendered using a darker colour.
     */
<span class="fc" id="L96">    private boolean darkerSides = false;  // default preserves previous behaviour</span>

    /**
     * Creates a new instance with no dataset.
     */
    public PiePlot3D() {
<span class="fc" id="L102">        this(null);</span>
<span class="fc" id="L103">    }</span>

    /**
     * Creates a pie chart with a three dimensional effect using the specified
     * dataset.
     *
     * @param dataset  the dataset ({@code null} permitted).
     */
    public PiePlot3D(PieDataset dataset) {
<span class="fc" id="L112">        super(dataset);</span>
<span class="fc" id="L113">        setCircular(false, false);</span>
<span class="fc" id="L114">    }</span>

    /**
     * Returns the depth factor for the chart.
     *
     * @return The depth factor.
     *
     * @see #setDepthFactor(double)
     */
    public double getDepthFactor() {
<span class="nc" id="L124">        return this.depthFactor;</span>
    }

    /**
     * Sets the pie depth as a percentage of the height of the plot area, and
     * sends a {@link PlotChangeEvent} to all registered listeners.
     *
     * @param factor  the depth factor (for example, 0.20 is twenty percent).
     *
     * @see #getDepthFactor()
     */
    public void setDepthFactor(double factor) {
<span class="fc" id="L136">        this.depthFactor = factor;</span>
<span class="fc" id="L137">        fireChangeEvent();</span>
<span class="fc" id="L138">    }</span>

    /**
     * Returns a flag that controls whether or not the sides of the pie chart
     * are rendered using a darker colour.
     *
     * @return A boolean.
     *
     * @see #setDarkerSides(boolean)
     */
    public boolean getDarkerSides() {
<span class="fc" id="L149">        return this.darkerSides;</span>
    }

    /**
     * Sets a flag that controls whether or not the sides of the pie chart
     * are rendered using a darker colour, and sends a {@link PlotChangeEvent}
     * to all registered listeners.
     *
     * @param darker true to darken the sides, false to use the default
     *         behaviour.
     *
     * @see #getDarkerSides()
     */
    public void setDarkerSides(boolean darker) {
<span class="fc" id="L163">        this.darkerSides = darker;</span>
<span class="fc" id="L164">        fireChangeEvent();</span>
<span class="fc" id="L165">    }</span>

    /**
     * Draws the plot on a Java 2D graphics device (such as the screen or a
     * printer).  This method is called by the
     * {@link org.jfree.chart.JFreeChart} class, you don't normally need
     * to call it yourself.
     *
     * @param g2  the graphics device.
     * @param plotArea  the area within which the plot should be drawn.
     * @param anchor  the anchor point.
     * @param parentState  the state from the parent plot, if there is one.
     * @param info  collects info about the drawing
     *              ({@code null} permitted).
     */
    @Override
    public void draw(Graphics2D g2, Rectangle2D plotArea, Point2D anchor,
                     PlotState parentState, PlotRenderingInfo info) {

        // adjust for insets...
<span class="fc" id="L185">        RectangleInsets insets = getInsets();</span>
<span class="fc" id="L186">        insets.trim(plotArea);</span>

<span class="fc" id="L188">        Rectangle2D originalPlotArea = (Rectangle2D) plotArea.clone();</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">        if (info != null) {</span>
<span class="nc" id="L190">            info.setPlotArea(plotArea);</span>
<span class="nc" id="L191">            info.setDataArea(plotArea);</span>
        }

<span class="fc" id="L194">        drawBackground(g2, plotArea);</span>

<span class="fc" id="L196">        Shape savedClip = g2.getClip();</span>
<span class="fc" id="L197">        g2.clip(plotArea);</span>

<span class="fc" id="L199">        Graphics2D savedG2 = g2;</span>
<span class="fc" id="L200">        BufferedImage dataImage = null;</span>
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">        if (getShadowGenerator() != null) {</span>
<span class="nc" id="L202">            dataImage = new BufferedImage((int) plotArea.getWidth(),</span>
<span class="nc" id="L203">                (int) plotArea.getHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc" id="L204">            g2 = dataImage.createGraphics();</span>
<span class="nc" id="L205">            g2.translate(-plotArea.getX(), -plotArea.getY());</span>
<span class="nc" id="L206">            g2.setRenderingHints(savedG2.getRenderingHints());</span>
<span class="nc" id="L207">            originalPlotArea = (Rectangle2D) plotArea.clone();</span>
        }
        // adjust the plot area by the interior spacing value
<span class="fc" id="L210">        double gapPercent = getInteriorGap();</span>
<span class="fc" id="L211">        double labelPercent = 0.0;</span>
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        if (getLabelGenerator() != null) {</span>
<span class="fc" id="L213">            labelPercent = getLabelGap() + getMaximumLabelWidth();</span>
        }
<span class="fc" id="L215">        double gapHorizontal = plotArea.getWidth() * (gapPercent</span>
                + labelPercent) * 2.0;
<span class="fc" id="L217">        double gapVertical = plotArea.getHeight() * gapPercent * 2.0;</span>

        if (DEBUG_DRAW_INTERIOR) {
            double hGap = plotArea.getWidth() * getInteriorGap();
            double vGap = plotArea.getHeight() * getInteriorGap();
            double igx1 = plotArea.getX() + hGap;
            double igx2 = plotArea.getMaxX() - hGap;
            double igy1 = plotArea.getY() + vGap;
            double igy2 = plotArea.getMaxY() - vGap;
            g2.setPaint(Color.LIGHT_GRAY);
            g2.draw(new Rectangle2D.Double(igx1, igy1, igx2 - igx1,
                    igy2 - igy1));
        }

<span class="fc" id="L231">        double linkX = plotArea.getX() + gapHorizontal / 2;</span>
<span class="fc" id="L232">        double linkY = plotArea.getY() + gapVertical / 2;</span>
<span class="fc" id="L233">        double linkW = plotArea.getWidth() - gapHorizontal;</span>
<span class="fc" id="L234">        double linkH = plotArea.getHeight() - gapVertical;</span>

        // make the link area a square if the pie chart is to be circular...
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">        if (isCircular()) { // is circular?</span>
<span class="nc" id="L238">            double min = Math.min(linkW, linkH) / 2;</span>
<span class="nc" id="L239">            linkX = (linkX + linkX + linkW) / 2 - min;</span>
<span class="nc" id="L240">            linkY = (linkY + linkY + linkH) / 2 - min;</span>
<span class="nc" id="L241">            linkW = 2 * min;</span>
<span class="nc" id="L242">            linkH = 2 * min;</span>
        }

<span class="fc" id="L245">        PiePlotState state = initialise(g2, plotArea, this, null, info);</span>

        // the link area defines the dog leg points for the linking lines to
        // the labels
<span class="fc" id="L249">        Rectangle2D linkAreaXX = new Rectangle2D.Double(linkX, linkY, linkW,</span>
                linkH * (1 - this.depthFactor));
<span class="fc" id="L251">        state.setLinkArea(linkAreaXX);</span>

        if (DEBUG_DRAW_LINK_AREA) {
            g2.setPaint(Color.BLUE);
            g2.draw(linkAreaXX);
            g2.setPaint(Color.YELLOW);
            g2.draw(new Ellipse2D.Double(linkAreaXX.getX(), linkAreaXX.getY(),
                    linkAreaXX.getWidth(), linkAreaXX.getHeight()));
        }

        // the explode area defines the max circle/ellipse for the exploded pie
        // sections.
        // it is defined by shrinking the linkArea by the linkMargin factor.
<span class="fc" id="L264">        double hh = linkW * getLabelLinkMargin();</span>
<span class="fc" id="L265">        double vv = linkH * getLabelLinkMargin();</span>
<span class="fc" id="L266">        Rectangle2D explodeArea = new Rectangle2D.Double(linkX + hh / 2.0,</span>
                linkY + vv / 2.0, linkW - hh, linkH - vv);

<span class="fc" id="L269">        state.setExplodedPieArea(explodeArea);</span>

        // the pie area defines the circle/ellipse for regular pie sections.
        // it is defined by shrinking the explodeArea by the explodeMargin
        // factor.
<span class="fc" id="L274">        double maximumExplodePercent = getMaximumExplodePercent();</span>
<span class="fc" id="L275">        double percent = maximumExplodePercent / (1.0 + maximumExplodePercent);</span>

<span class="fc" id="L277">        double h1 = explodeArea.getWidth() * percent;</span>
<span class="fc" id="L278">        double v1 = explodeArea.getHeight() * percent;</span>
<span class="fc" id="L279">        Rectangle2D pieArea = new Rectangle2D.Double(explodeArea.getX()</span>
<span class="fc" id="L280">                + h1 / 2.0, explodeArea.getY() + v1 / 2.0,</span>
<span class="fc" id="L281">                explodeArea.getWidth() - h1, explodeArea.getHeight() - v1);</span>

        // the link area defines the dog-leg point for the linking lines to
        // the labels
<span class="fc" id="L285">        int depth = (int) (pieArea.getHeight() * this.depthFactor);</span>
<span class="fc" id="L286">        Rectangle2D linkArea = new Rectangle2D.Double(linkX, linkY, linkW,</span>
                linkH - depth);
<span class="fc" id="L288">        state.setLinkArea(linkArea);</span>

<span class="fc" id="L290">        state.setPieArea(pieArea);</span>
<span class="fc" id="L291">        state.setPieCenterX(pieArea.getCenterX());</span>
<span class="fc" id="L292">        state.setPieCenterY(pieArea.getCenterY() - depth / 2.0);</span>
<span class="fc" id="L293">        state.setPieWRadius(pieArea.getWidth() / 2.0);</span>
<span class="fc" id="L294">        state.setPieHRadius((pieArea.getHeight() - depth) / 2.0);</span>

        // get the data source - return if null;
<span class="fc" id="L297">        PieDataset dataset = getDataset();</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">        if (DatasetUtils.isEmptyOrNull(getDataset())) {</span>
<span class="fc" id="L299">            drawNoDataMessage(g2, plotArea);</span>
<span class="fc" id="L300">            g2.setClip(savedClip);</span>
<span class="fc" id="L301">            drawOutline(g2, plotArea);</span>
<span class="fc" id="L302">            return;</span>
        }

        // if too any elements
<span class="pc bpc" id="L306" title="1 of 2 branches missed.">        if (dataset.getKeys().size() &gt; plotArea.getWidth()) {</span>
<span class="nc" id="L307">            String text = localizationResources.getString(&quot;Too_many_elements&quot;);</span>
<span class="nc" id="L308">            Font sfont = new Font(&quot;dialog&quot;, Font.BOLD, 10);</span>
<span class="nc" id="L309">            g2.setFont(sfont);</span>
<span class="nc" id="L310">            FontMetrics fm = g2.getFontMetrics(sfont);</span>
<span class="nc" id="L311">            int stringWidth = fm.stringWidth(text);</span>

<span class="nc" id="L313">            g2.drawString(text, (int) (plotArea.getX() + (plotArea.getWidth()</span>
<span class="nc" id="L314">                    - stringWidth) / 2), (int) (plotArea.getY()</span>
<span class="nc" id="L315">                    + (plotArea.getHeight() / 2)));</span>
<span class="nc" id="L316">            return;</span>
        }
        // if we are drawing a perfect circle, we need to readjust the top left
        // coordinates of the drawing area for the arcs to arrive at this
        // effect.
<span class="pc bpc" id="L321" title="1 of 2 branches missed.">        if (isCircular()) {</span>
<span class="nc" id="L322">            double min = Math.min(plotArea.getWidth(),</span>
<span class="nc" id="L323">                    plotArea.getHeight()) / 2;</span>
<span class="nc" id="L324">            plotArea = new Rectangle2D.Double(plotArea.getCenterX() - min,</span>
<span class="nc" id="L325">                    plotArea.getCenterY() - min, 2 * min, 2 * min);</span>
        }
        // get a list of keys...
<span class="fc" id="L328">        List sectionKeys = dataset.getKeys();</span>

<span class="pc bpc" id="L330" title="1 of 2 branches missed.">        if (sectionKeys.isEmpty()) {</span>
<span class="nc" id="L331">            return;</span>
        }

        // establish the coordinates of the top left corner of the drawing area
<span class="fc" id="L335">        double arcX = pieArea.getX();</span>
<span class="fc" id="L336">        double arcY = pieArea.getY();</span>

        //g2.clip(clipArea);
<span class="fc" id="L339">        Composite originalComposite = g2.getComposite();</span>
<span class="fc" id="L340">        g2.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER,</span>
<span class="fc" id="L341">                getForegroundAlpha()));</span>

<span class="fc" id="L343">        double totalValue = DatasetUtils.calculatePieDatasetTotal(dataset);</span>
<span class="fc" id="L344">        double runningTotal = 0;</span>
<span class="pc bpc" id="L345" title="1 of 2 branches missed.">        if (depth &lt; 0) {</span>
<span class="nc" id="L346">            return;  // if depth is negative don't draw anything</span>
        }

<span class="fc" id="L349">        ArrayList arcList = new ArrayList();</span>
        Arc2D.Double arc;
        Paint paint;
        Paint outlinePaint;
        Stroke outlineStroke;

<span class="fc" id="L355">        Iterator iterator = sectionKeys.iterator();</span>
<span class="fc bfc" id="L356" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>

<span class="fc" id="L358">            Comparable currentKey = (Comparable) iterator.next();</span>
<span class="fc" id="L359">            Number dataValue = dataset.getValue(currentKey);</span>
<span class="fc bfc" id="L360" title="All 2 branches covered.">            if (dataValue == null) {</span>
<span class="fc" id="L361">                arcList.add(null);</span>
<span class="fc" id="L362">                continue;</span>
            }
<span class="fc" id="L364">            double value = dataValue.doubleValue();</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">            if (value &lt;= 0) {</span>
<span class="nc" id="L366">                arcList.add(null);</span>
<span class="nc" id="L367">                continue;</span>
            }
<span class="fc" id="L369">            double startAngle = getStartAngle();</span>
<span class="fc" id="L370">            double direction = getDirection().getFactor();</span>
<span class="fc" id="L371">            double angle1 = startAngle + (direction * (runningTotal * 360))</span>
                    / totalValue;
<span class="fc" id="L373">            double angle2 = startAngle + (direction * (runningTotal + value)</span>
                    * 360) / totalValue;
<span class="pc bpc" id="L375" title="1 of 2 branches missed.">            if (Math.abs(angle2 - angle1) &gt; getMinimumArcAngleToDraw()) {</span>
<span class="fc" id="L376">                arcList.add(new Arc2D.Double(arcX, arcY + depth,</span>
<span class="fc" id="L377">                        pieArea.getWidth(), pieArea.getHeight() - depth,</span>
                        angle1, angle2 - angle1, Arc2D.PIE));
            }
            else {
<span class="nc" id="L381">                arcList.add(null);</span>
            }
<span class="fc" id="L383">            runningTotal += value;</span>
<span class="fc" id="L384">        }</span>

<span class="fc" id="L386">        Shape oldClip = g2.getClip();</span>

<span class="fc" id="L388">        Ellipse2D top = new Ellipse2D.Double(pieArea.getX(), pieArea.getY(),</span>
<span class="fc" id="L389">                pieArea.getWidth(), pieArea.getHeight() - depth);</span>

<span class="fc" id="L391">        Ellipse2D bottom = new Ellipse2D.Double(pieArea.getX(), pieArea.getY()</span>
<span class="fc" id="L392">                + depth, pieArea.getWidth(), pieArea.getHeight() - depth);</span>

<span class="fc" id="L394">        Rectangle2D lower = new Rectangle2D.Double(top.getX(),</span>
<span class="fc" id="L395">                top.getCenterY(), pieArea.getWidth(), bottom.getMaxY()</span>
<span class="fc" id="L396">                - top.getCenterY());</span>

<span class="fc" id="L398">        Rectangle2D upper = new Rectangle2D.Double(pieArea.getX(), top.getY(),</span>
<span class="fc" id="L399">                pieArea.getWidth(), bottom.getCenterY() - top.getY());</span>

<span class="fc" id="L401">        Area a = new Area(top);</span>
<span class="fc" id="L402">        a.add(new Area(lower));</span>
<span class="fc" id="L403">        Area b = new Area(bottom);</span>
<span class="fc" id="L404">        b.add(new Area(upper));</span>
<span class="fc" id="L405">        Area pie = new Area(a);</span>
<span class="fc" id="L406">        pie.intersect(b);</span>

<span class="fc" id="L408">        Area front = new Area(pie);</span>
<span class="fc" id="L409">        front.subtract(new Area(top));</span>

<span class="fc" id="L411">        Area back = new Area(pie);</span>
<span class="fc" id="L412">        back.subtract(new Area(bottom));</span>

        // draw the bottom circle
        int[] xs;
        int[] ys;

<span class="fc" id="L418">        int categoryCount = arcList.size();</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">        for (int categoryIndex = 0; categoryIndex &lt; categoryCount;</span>
<span class="fc" id="L420">                 categoryIndex++) {</span>
<span class="fc" id="L421">            arc = (Arc2D.Double) arcList.get(categoryIndex);</span>
<span class="fc bfc" id="L422" title="All 2 branches covered.">            if (arc == null) {</span>
<span class="fc" id="L423">                continue;</span>
            }
<span class="fc" id="L425">            Comparable key = getSectionKey(categoryIndex);</span>
<span class="fc" id="L426">            paint = lookupSectionPaint(key);</span>
<span class="fc" id="L427">            outlinePaint = lookupSectionOutlinePaint(key);</span>
<span class="fc" id="L428">            outlineStroke = lookupSectionOutlineStroke(key);</span>
<span class="fc" id="L429">            g2.setPaint(paint);</span>
<span class="fc" id="L430">            g2.fill(arc);</span>
<span class="fc" id="L431">            g2.setPaint(outlinePaint);</span>
<span class="fc" id="L432">            g2.setStroke(outlineStroke);</span>
<span class="fc" id="L433">            g2.draw(arc);</span>
<span class="fc" id="L434">            g2.setPaint(paint);</span>

<span class="fc" id="L436">            Point2D p1 = arc.getStartPoint();</span>

            // draw the height
<span class="fc" id="L439">            xs = new int[] {(int) arc.getCenterX(), (int) arc.getCenterX(),</span>
<span class="fc" id="L440">                    (int) p1.getX(), (int) p1.getX()};</span>
<span class="fc" id="L441">            ys = new int[] {(int) arc.getCenterY(), (int) arc.getCenterY()</span>
<span class="fc" id="L442">                    - depth, (int) p1.getY() - depth, (int) p1.getY()};</span>
<span class="fc" id="L443">            Polygon polygon = new Polygon(xs, ys, 4);</span>
<span class="fc" id="L444">            g2.setPaint(java.awt.Color.LIGHT_GRAY);</span>
<span class="fc" id="L445">            g2.fill(polygon);</span>
<span class="fc" id="L446">            g2.setPaint(outlinePaint);</span>
<span class="fc" id="L447">            g2.setStroke(outlineStroke);</span>
<span class="fc" id="L448">            g2.draw(polygon);</span>
<span class="fc" id="L449">            g2.setPaint(paint);</span>

        }

<span class="fc" id="L453">        g2.setPaint(Color.GRAY);</span>
<span class="fc" id="L454">        g2.fill(back);</span>
<span class="fc" id="L455">        g2.fill(front);</span>

        // cycle through once drawing only the sides at the back...
<span class="fc" id="L458">        int cat = 0;</span>
<span class="fc" id="L459">        iterator = arcList.iterator();</span>
<span class="fc bfc" id="L460" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L461">            Arc2D segment = (Arc2D) iterator.next();</span>
<span class="fc bfc" id="L462" title="All 2 branches covered.">            if (segment != null) {</span>
<span class="fc" id="L463">                Comparable key = getSectionKey(cat);</span>
<span class="fc" id="L464">                paint = lookupSectionPaint(key);</span>
<span class="fc" id="L465">                outlinePaint = lookupSectionOutlinePaint(key);</span>
<span class="fc" id="L466">                outlineStroke = lookupSectionOutlineStroke(key);</span>
<span class="fc" id="L467">                drawSide(g2, pieArea, segment, front, back, paint,</span>
                        outlinePaint, outlineStroke, false, true);
            }
<span class="fc" id="L470">            cat++;</span>
<span class="fc" id="L471">        }</span>

        // cycle through again drawing only the sides at the front...
<span class="fc" id="L474">        cat = 0;</span>
<span class="fc" id="L475">        iterator = arcList.iterator();</span>
<span class="fc bfc" id="L476" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L477">            Arc2D segment = (Arc2D) iterator.next();</span>
<span class="fc bfc" id="L478" title="All 2 branches covered.">            if (segment != null) {</span>
<span class="fc" id="L479">                Comparable key = getSectionKey(cat);</span>
<span class="fc" id="L480">                paint = lookupSectionPaint(key);</span>
<span class="fc" id="L481">                outlinePaint = lookupSectionOutlinePaint(key);</span>
<span class="fc" id="L482">                outlineStroke = lookupSectionOutlineStroke(key);</span>
<span class="fc" id="L483">                drawSide(g2, pieArea, segment, front, back, paint,</span>
                        outlinePaint, outlineStroke, true, false);
            }
<span class="fc" id="L486">            cat++;</span>
<span class="fc" id="L487">        }</span>

<span class="fc" id="L489">        g2.setClip(oldClip);</span>

        // draw the sections at the top of the pie (and set up tooltips)...
        Arc2D upperArc;
<span class="fc bfc" id="L493" title="All 2 branches covered.">        for (int sectionIndex = 0; sectionIndex &lt; categoryCount;</span>
<span class="fc" id="L494">                 sectionIndex++) {</span>
<span class="fc" id="L495">            arc = (Arc2D.Double) arcList.get(sectionIndex);</span>
<span class="fc bfc" id="L496" title="All 2 branches covered.">            if (arc == null) {</span>
<span class="fc" id="L497">                continue;</span>
            }
<span class="fc" id="L499">            upperArc = new Arc2D.Double(arcX, arcY, pieArea.getWidth(),</span>
<span class="fc" id="L500">                    pieArea.getHeight() - depth, arc.getAngleStart(),</span>
<span class="fc" id="L501">                    arc.getAngleExtent(), Arc2D.PIE);</span>

<span class="fc" id="L503">            Comparable currentKey = (Comparable) sectionKeys.get(sectionIndex);</span>
<span class="fc" id="L504">            paint = lookupSectionPaint(currentKey, true);</span>
<span class="fc" id="L505">            outlinePaint = lookupSectionOutlinePaint(currentKey);</span>
<span class="fc" id="L506">            outlineStroke = lookupSectionOutlineStroke(currentKey);</span>
<span class="fc" id="L507">            g2.setPaint(paint);</span>
<span class="fc" id="L508">            g2.fill(upperArc);</span>
<span class="fc" id="L509">            g2.setStroke(outlineStroke);</span>
<span class="fc" id="L510">            g2.setPaint(outlinePaint);</span>
<span class="fc" id="L511">            g2.draw(upperArc);</span>

           // add a tooltip for the section...
<span class="pc bpc" id="L514" title="1 of 2 branches missed.">            if (info != null) {</span>
<span class="nc" id="L515">                EntityCollection entities</span>
<span class="nc" id="L516">                        = info.getOwner().getEntityCollection();</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">                if (entities != null) {</span>
<span class="nc" id="L518">                    String tip = null;</span>
<span class="nc" id="L519">                    PieToolTipGenerator tipster = getToolTipGenerator();</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">                    if (tipster != null) {</span>
                        // @mgs: using the method's return value was missing
<span class="nc" id="L522">                        tip = tipster.generateToolTip(dataset, currentKey);</span>
                    }
<span class="nc" id="L524">                    String url = null;</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">                    if (getURLGenerator() != null) {</span>
<span class="nc" id="L526">                        url = getURLGenerator().generateURL(dataset, currentKey,</span>
<span class="nc" id="L527">                                getPieIndex());</span>
                    }
<span class="nc" id="L529">                    PieSectionEntity entity = new PieSectionEntity(</span>
<span class="nc" id="L530">                            upperArc, dataset, getPieIndex(), sectionIndex,</span>
                            currentKey, tip, url);
<span class="nc" id="L532">                    entities.add(entity);</span>
                }
            }
        }

<span class="fc" id="L537">        List keys = dataset.getKeys();</span>
<span class="fc" id="L538">        Rectangle2D adjustedPlotArea = new Rectangle2D.Double(</span>
<span class="fc" id="L539">                originalPlotArea.getX(), originalPlotArea.getY(),</span>
<span class="fc" id="L540">                originalPlotArea.getWidth(), originalPlotArea.getHeight()</span>
                - depth);
<span class="pc bpc" id="L542" title="1 of 2 branches missed.">        if (getSimpleLabels()) {</span>
<span class="nc" id="L543">            drawSimpleLabels(g2, keys, totalValue, adjustedPlotArea,</span>
                    linkArea, state);
        }
        else {
<span class="fc" id="L547">            drawLabels(g2, keys, totalValue, adjustedPlotArea, linkArea,</span>
                    state);
        }

<span class="pc bpc" id="L551" title="1 of 2 branches missed.">        if (getShadowGenerator() != null) {</span>
<span class="nc" id="L552">            BufferedImage shadowImage</span>
<span class="nc" id="L553">                    = getShadowGenerator().createDropShadow(dataImage);</span>
<span class="nc" id="L554">            g2 = savedG2;</span>
<span class="nc" id="L555">            g2.drawImage(shadowImage, (int) plotArea.getX()</span>
<span class="nc" id="L556">                    + getShadowGenerator().calculateOffsetX(),</span>
<span class="nc" id="L557">                    (int) plotArea.getY()</span>
<span class="nc" id="L558">                    + getShadowGenerator().calculateOffsetY(), null);</span>
<span class="nc" id="L559">            g2.drawImage(dataImage, (int) plotArea.getX(),</span>
<span class="nc" id="L560">                    (int) plotArea.getY(), null);</span>
        }

<span class="fc" id="L563">        g2.setClip(savedClip);</span>
<span class="fc" id="L564">        g2.setComposite(originalComposite);</span>
<span class="fc" id="L565">        drawOutline(g2, originalPlotArea);</span>

<span class="fc" id="L567">    }</span>

    /**
     * Draws the side of a pie section.
     *
     * @param g2  the graphics device.
     * @param plotArea  the plot area.
     * @param arc  the arc.
     * @param front  the front of the pie.
     * @param back  the back of the pie.
     * @param paint  the color.
     * @param outlinePaint  the outline paint.
     * @param outlineStroke  the outline stroke.
     * @param drawFront  draw the front?
     * @param drawBack  draw the back?
     */
    protected void drawSide(Graphics2D g2,
                            Rectangle2D plotArea,
                            Arc2D arc,
                            Area front,
                            Area back,
                            Paint paint,
                            Paint outlinePaint,
                            Stroke outlineStroke,
                            boolean drawFront,
                            boolean drawBack) {

<span class="pc bpc" id="L594" title="1 of 2 branches missed.">        if (getDarkerSides()) {</span>
<span class="nc" id="L595">             paint = PaintAlpha.darker(paint);</span>
        }

<span class="fc" id="L598">        double start = arc.getAngleStart();</span>
<span class="fc" id="L599">        double extent = arc.getAngleExtent();</span>
<span class="fc" id="L600">        double end = start + extent;</span>

<span class="fc" id="L602">        g2.setStroke(outlineStroke);</span>

        // for CLOCKWISE charts, the extent will be negative...
<span class="pc bpc" id="L605" title="1 of 2 branches missed.">        if (extent &lt; 0.0) {</span>

<span class="fc bfc" id="L607" title="All 2 branches covered.">            if (isAngleAtFront(start)) {  // start at front</span>

<span class="pc bpc" id="L609" title="1 of 2 branches missed.">                if (!isAngleAtBack(end)) {</span>

<span class="nc bnc" id="L611" title="All 2 branches missed.">                    if (extent &gt; -180.0) {  // the segment is entirely at the</span>
                                            // front of the chart
<span class="nc bnc" id="L613" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L614">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L615">                                    arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L616">                                    arc.getStartPoint().getX()</span>
<span class="nc" id="L617">                                    - arc.getEndPoint().getX(),</span>
<span class="nc" id="L618">                                    plotArea.getHeight()));</span>
<span class="nc" id="L619">                            side.intersect(front);</span>
<span class="nc" id="L620">                            g2.setPaint(paint);</span>
<span class="nc" id="L621">                            g2.fill(side);</span>
<span class="nc" id="L622">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L623">                            g2.draw(side);</span>
<span class="nc" id="L624">                        }</span>
                    }
                    else {  // the segment starts at the front, and wraps all
                            // the way around
                            // the back and finishes at the front again
<span class="nc" id="L629">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L630">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L631">                                arc.getStartPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L632">                                plotArea.getHeight()));</span>
<span class="nc" id="L633">                        side1.intersect(front);</span>

<span class="nc" id="L635">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L636">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L637">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="nc" id="L638">                                plotArea.getHeight()));</span>

<span class="nc" id="L640">                        side2.intersect(front);</span>
<span class="nc" id="L641">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L643">                            g2.fill(side1);</span>
<span class="nc" id="L644">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L647" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L648">                            g2.fill(back);</span>
                        }

<span class="nc" id="L651">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L653">                            g2.draw(side1);</span>
<span class="nc" id="L654">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L657" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L658">                            g2.draw(back);</span>
                        }

<span class="nc" id="L661">                    }</span>
                }
                else {  // starts at the front, finishes at the back (going
                        // around the left side)

<span class="fc bfc" id="L666" title="All 2 branches covered.">                    if (drawBack) {</span>
<span class="fc" id="L667">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L668">                                plotArea.getX(), plotArea.getY(),</span>
<span class="fc" id="L669">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="fc" id="L670">                                plotArea.getHeight()));</span>
<span class="fc" id="L671">                        side2.intersect(back);</span>
<span class="fc" id="L672">                        g2.setPaint(paint);</span>
<span class="fc" id="L673">                        g2.fill(side2);</span>
<span class="fc" id="L674">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L675">                        g2.draw(side2);</span>
                    }

<span class="fc bfc" id="L678" title="All 2 branches covered.">                    if (drawFront) {</span>
<span class="fc" id="L679">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L680">                                plotArea.getX(), plotArea.getY(),</span>
<span class="fc" id="L681">                                arc.getStartPoint().getX() - plotArea.getX(),</span>
<span class="fc" id="L682">                                plotArea.getHeight()));</span>
<span class="fc" id="L683">                        side1.intersect(front);</span>
<span class="fc" id="L684">                        g2.setPaint(paint);</span>
<span class="fc" id="L685">                        g2.fill(side1);</span>
<span class="fc" id="L686">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L687">                        g2.draw(side1);</span>
<span class="fc" id="L688">                    }</span>
                }
            }
            else {  // the segment starts at the back (still extending
                    // CLOCKWISE)

<span class="pc bpc" id="L694" title="1 of 2 branches missed.">                if (!isAngleAtFront(end)) {</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">                    if (extent &gt; -180.0) {  // whole segment stays at the back</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L697">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L698">                                    arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L699">                                    arc.getEndPoint().getX()</span>
<span class="nc" id="L700">                                    - arc.getStartPoint().getX(),</span>
<span class="nc" id="L701">                                    plotArea.getHeight()));</span>
<span class="nc" id="L702">                            side.intersect(back);</span>
<span class="nc" id="L703">                            g2.setPaint(paint);</span>
<span class="nc" id="L704">                            g2.fill(side);</span>
<span class="nc" id="L705">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L706">                            g2.draw(side);</span>
<span class="nc" id="L707">                        }</span>
                    }
                    else {  // starts at the back, wraps around front, and
                            // finishes at back again
<span class="nc" id="L711">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L712">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L713">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L714">                                plotArea.getHeight()));</span>
<span class="nc" id="L715">                        side1.intersect(back);</span>

<span class="nc" id="L717">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L718">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L719">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L720">                                plotArea.getHeight()));</span>

<span class="nc" id="L722">                        side2.intersect(back);</span>

<span class="nc" id="L724">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L726">                            g2.fill(side1);</span>
<span class="nc" id="L727">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L730" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L731">                            g2.fill(front);</span>
                        }

<span class="nc" id="L734">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L736">                            g2.draw(side1);</span>
<span class="nc" id="L737">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L740" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L741">                            g2.draw(front);</span>
                        }

<span class="nc" id="L744">                    }</span>
                }
                else {  // starts at back, finishes at front (CLOCKWISE)

<span class="fc bfc" id="L748" title="All 2 branches covered.">                    if (drawBack) {</span>
<span class="fc" id="L749">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L750">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="fc" id="L751">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="fc" id="L752">                                plotArea.getHeight()));</span>
<span class="fc" id="L753">                        side1.intersect(back);</span>
<span class="fc" id="L754">                        g2.setPaint(paint);</span>
<span class="fc" id="L755">                        g2.fill(side1);</span>
<span class="fc" id="L756">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L757">                        g2.draw(side1);</span>
                    }

<span class="fc bfc" id="L760" title="All 2 branches covered.">                    if (drawFront) {</span>
<span class="fc" id="L761">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="fc" id="L762">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="fc" id="L763">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="fc" id="L764">                                plotArea.getHeight()));</span>
<span class="fc" id="L765">                        side2.intersect(front);</span>
<span class="fc" id="L766">                        g2.setPaint(paint);</span>
<span class="fc" id="L767">                        g2.fill(side2);</span>
<span class="fc" id="L768">                        g2.setPaint(outlinePaint);</span>
<span class="fc" id="L769">                        g2.draw(side2);</span>
<span class="fc" id="L770">                    }</span>

                }
            }
        }
<span class="nc bnc" id="L775" title="All 2 branches missed.">        else if (extent &gt; 0.0) {  // the pie sections are arranged ANTICLOCKWISE</span>

<span class="nc bnc" id="L777" title="All 2 branches missed.">            if (isAngleAtFront(start)) {  // segment starts at the front</span>

<span class="nc bnc" id="L779" title="All 2 branches missed.">                if (!isAngleAtBack(end)) {  // and finishes at the front</span>

<span class="nc bnc" id="L781" title="All 2 branches missed.">                    if (extent &lt; 180.0) {  // segment only occupies the front</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L783">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L784">                                    arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L785">                                    arc.getEndPoint().getX()</span>
<span class="nc" id="L786">                                    - arc.getStartPoint().getX(),</span>
<span class="nc" id="L787">                                    plotArea.getHeight()));</span>
<span class="nc" id="L788">                            side.intersect(front);</span>
<span class="nc" id="L789">                            g2.setPaint(paint);</span>
<span class="nc" id="L790">                            g2.fill(side);</span>
<span class="nc" id="L791">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L792">                            g2.draw(side);</span>
<span class="nc" id="L793">                        }</span>
                    }
                    else {  // segments wraps right around the back...
<span class="nc" id="L796">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L797">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L798">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L799">                                plotArea.getHeight()));</span>
<span class="nc" id="L800">                        side1.intersect(front);</span>

<span class="nc" id="L802">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L803">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L804">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L805">                                plotArea.getHeight()));</span>
<span class="nc" id="L806">                        side2.intersect(front);</span>

<span class="nc" id="L808">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L810">                            g2.fill(side1);</span>
<span class="nc" id="L811">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L814" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L815">                            g2.fill(back);</span>
                        }

<span class="nc" id="L818">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L820">                            g2.draw(side1);</span>
<span class="nc" id="L821">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L824" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L825">                            g2.draw(back);</span>
                        }

<span class="nc" id="L828">                    }</span>
                }
                else {  // segments starts at front and finishes at back...
<span class="nc bnc" id="L831" title="All 2 branches missed.">                    if (drawBack) {</span>
<span class="nc" id="L832">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L833">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L834">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="nc" id="L835">                                plotArea.getHeight()));</span>
<span class="nc" id="L836">                        side2.intersect(back);</span>
<span class="nc" id="L837">                        g2.setPaint(paint);</span>
<span class="nc" id="L838">                        g2.fill(side2);</span>
<span class="nc" id="L839">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L840">                        g2.draw(side2);</span>
                    }

<span class="nc bnc" id="L843" title="All 2 branches missed.">                    if (drawFront) {</span>
<span class="nc" id="L844">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L845">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L846">                                plotArea.getMaxX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L847">                                plotArea.getHeight()));</span>
<span class="nc" id="L848">                        side1.intersect(front);</span>
<span class="nc" id="L849">                        g2.setPaint(paint);</span>
<span class="nc" id="L850">                        g2.fill(side1);</span>
<span class="nc" id="L851">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L852">                        g2.draw(side1);</span>
<span class="nc" id="L853">                    }</span>
                }
            }
            else {  // segment starts at back

<span class="nc bnc" id="L858" title="All 2 branches missed.">                if (!isAngleAtFront(end)) {</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">                    if (extent &lt; 180.0) {  // and finishes at back</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L861">                            Area side = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L862">                                    arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L863">                                    arc.getStartPoint().getX()</span>
<span class="nc" id="L864">                                    - arc.getEndPoint().getX(),</span>
<span class="nc" id="L865">                                    plotArea.getHeight()));</span>
<span class="nc" id="L866">                            side.intersect(back);</span>
<span class="nc" id="L867">                            g2.setPaint(paint);</span>
<span class="nc" id="L868">                            g2.fill(side);</span>
<span class="nc" id="L869">                            g2.setPaint(outlinePaint);</span>
<span class="nc" id="L870">                            g2.draw(side);</span>
<span class="nc" id="L871">                        }</span>
                    }
                    else {  // starts at back and wraps right around to the
                            // back again
<span class="nc" id="L875">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L876">                                arc.getStartPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L877">                                plotArea.getX() - arc.getStartPoint().getX(),</span>
<span class="nc" id="L878">                                plotArea.getHeight()));</span>
<span class="nc" id="L879">                        side1.intersect(back);</span>

<span class="nc" id="L881">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L882">                                arc.getEndPoint().getX(), plotArea.getY(),</span>
<span class="nc" id="L883">                                plotArea.getMaxX() - arc.getEndPoint().getX(),</span>
<span class="nc" id="L884">                                plotArea.getHeight()));</span>
<span class="nc" id="L885">                        side2.intersect(back);</span>

<span class="nc" id="L887">                        g2.setPaint(paint);</span>
<span class="nc bnc" id="L888" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L889">                            g2.fill(side1);</span>
<span class="nc" id="L890">                            g2.fill(side2);</span>
                        }

<span class="nc bnc" id="L893" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L894">                            g2.fill(front);</span>
                        }

<span class="nc" id="L897">                        g2.setPaint(outlinePaint);</span>
<span class="nc bnc" id="L898" title="All 2 branches missed.">                        if (drawBack) {</span>
<span class="nc" id="L899">                            g2.draw(side1);</span>
<span class="nc" id="L900">                            g2.draw(side2);</span>
                        }

<span class="nc bnc" id="L903" title="All 2 branches missed.">                        if (drawFront) {</span>
<span class="nc" id="L904">                            g2.draw(front);</span>
                        }

<span class="nc" id="L907">                    }</span>
                }
                else {  // starts at the back and finishes at the front
                        // (wrapping the left side)
<span class="nc bnc" id="L911" title="All 2 branches missed.">                    if (drawBack) {</span>
<span class="nc" id="L912">                        Area side1 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L913">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L914">                                arc.getStartPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L915">                                plotArea.getHeight()));</span>
<span class="nc" id="L916">                        side1.intersect(back);</span>
<span class="nc" id="L917">                        g2.setPaint(paint);</span>
<span class="nc" id="L918">                        g2.fill(side1);</span>
<span class="nc" id="L919">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L920">                        g2.draw(side1);</span>
                    }

<span class="nc bnc" id="L923" title="All 2 branches missed.">                    if (drawFront) {</span>
<span class="nc" id="L924">                        Area side2 = new Area(new Rectangle2D.Double(</span>
<span class="nc" id="L925">                                plotArea.getX(), plotArea.getY(),</span>
<span class="nc" id="L926">                                arc.getEndPoint().getX() - plotArea.getX(),</span>
<span class="nc" id="L927">                                plotArea.getHeight()));</span>
<span class="nc" id="L928">                        side2.intersect(front);</span>
<span class="nc" id="L929">                        g2.setPaint(paint);</span>
<span class="nc" id="L930">                        g2.fill(side2);</span>
<span class="nc" id="L931">                        g2.setPaint(outlinePaint);</span>
<span class="nc" id="L932">                        g2.draw(side2);</span>
                    }
                }
            }

        }

<span class="fc" id="L939">    }</span>

    /**
     * Returns a short string describing the type of plot.
     *
     * @return &lt;i&gt;Pie 3D Plot&lt;/i&gt;.
     */
    @Override
    public String getPlotType() {
<span class="nc" id="L948">        return localizationResources.getString(&quot;Pie_3D_Plot&quot;);</span>
    }

    /**
     * A utility method that returns true if the angle represents a point at
     * the front of the 3D pie chart.  0 - 180 degrees is the back, 180 - 360
     * is the front.
     *
     * @param angle  the angle.
     *
     * @return A boolean.
     */
    private boolean isAngleAtFront(double angle) {
<span class="fc bfc" id="L961" title="All 2 branches covered.">        return (Math.sin(Math.toRadians(angle)) &lt; 0.0);</span>
    }

    /**
     * A utility method that returns true if the angle represents a point at
     * the back of the 3D pie chart.  0 - 180 degrees is the back, 180 - 360
     * is the front.
     *
     * @param angle  the angle.
     *
     * @return {@code true} if the angle is at the back of the pie.
     */
    private boolean isAngleAtBack(double angle) {
<span class="pc bpc" id="L974" title="1 of 2 branches missed.">        return (Math.sin(Math.toRadians(angle)) &gt; 0.0);</span>
    }

    /**
     * Tests this plot for equality with an arbitrary object.
     *
     * @param obj  the object ({@code null} permitted).
     *
     * @return A boolean.
     */
    @Override
    public boolean equals(Object obj) {
<span class="fc bfc" id="L986" title="All 2 branches covered.">        if (obj == this) {</span>
<span class="fc" id="L987">            return true;</span>
        }
<span class="pc bpc" id="L989" title="1 of 2 branches missed.">        if (!(obj instanceof PiePlot3D)) {</span>
<span class="nc" id="L990">            return false;</span>
        }
<span class="fc" id="L992">        PiePlot3D that = (PiePlot3D) obj;</span>
<span class="fc bfc" id="L993" title="All 2 branches covered.">        if (this.depthFactor != that.depthFactor) {</span>
<span class="fc" id="L994">            return false;</span>
        }
<span class="fc bfc" id="L996" title="All 2 branches covered.">        if (this.darkerSides != that.darkerSides) {</span>
<span class="fc" id="L997">            return false;</span>
        }
<span class="fc" id="L999">        return super.equals(obj);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>